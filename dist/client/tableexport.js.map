{"version":3,"sources":["../../client/tableexport.js"],"names":["root","factory","define","amd","require","$","e","exports","nodeName","module","TableExport","jQuery","Blob","saveAs","XLSX","selectors","options","self","_handleError","settings","_extend","defaults","_nodesArray","ignoreRows","Array","ignoreCols","ignoreCSS","emptyCSS","formatValue","bind","trimWhitespace","bootstrapSettings","_getBootstrapSettings","bootstrap","bootstrapConfig","defaultButton","_exportData","getExportData","forEach","el","context","rows","querySelectorAll","headers","concat","footers","thAdj","length","filename","getAttribute","defaultFilename","uuid","_uuid","checkCaption","exportButton","caption","defaultCaptionClass","appendChild","document","createElement","className","bootstrapSpacing","position","insertBefore","firstChild","setExportData","exporter","data","Storage","getInstance","getItem","type","substring","indexOf","JSON","parse","rcMap","RowColMap","build","formatMap","_FORMAT_LIST","reduce","acc","cur","formats","key","_isValidFormat","join","_hasDependencies","exporters","call","storageKey","_on","downloadHandler","prototype","version","exportButtons","CONSTANTS","FORMAT","XLSM","XLSB","BIFF2","XLS","CSV","TXT","TYPE","STRING","NUMBER","BOOLEAN","DATE","charset","defaultNamespace","tableKey","rowDel","entityMap","formatConfig","xlsx","defaultClass","buttonContent","mimeType","fileExtension","xlsm","xlsb","xls","separator","enforceStrictRFC4180","csv","txt","typeConfig","string","number","assert","v","isNaN","boolean","toLowerCase","date","test","Date","format","colDel","getReturn","val","_isEnhanced","textContent","t","getType","_FORMAT","replace","dataURI","map","ir","isIgnore","handleRowColMapProp","IGNORE","isEmpty","EMPTY","cols","ic","_return","DEFAULT","processCols","processRows","dataObject","stringify","merges","hashKey","_hashCode","createObjButton","setItem","myContent","myClass","setAttribute","bootstrapClass","bootstrapTheme","escapeHtml","String","s","unescapeHtml","str","RegExp","isTrimWhitespace","trim","types","_TYPE","dateNum","date1904","epoch","result","UTC","Math","floor","createSheet","ws","range","c","r","R","C","cell","cell_ref","utils","encode_cell","z","SSF","_table","encode_range","event","target","object","export2file","Workbook","SheetNames","Sheets","string2ArrayBuffer","buf","ArrayBuffer","view","Uint8Array","i","charCodeAt","mime","name","extension","getRawData","_isMobile","downloadDataURI","encodedUri","encodeURI","link","body","click","getBookType","wb","bookType","push","wopts","bookSST","wbout","write","getFileSize","binary","byteLength","update","remove","reset","querySelector","removeChild","_instance","store","sessionStorage","namespace","getKey","_key","value","overwrite","exists","removeItem","_ignore","getRowColMapProp","_empty","isRowSpan","_rowspan","ROWSPAN","undefined","isColSpan","_colspan","COLSPAN","isSpan","isMerge","addMerge","mergeObj","_merge","MERGE","setRowColMapProp","generateTotal","VALUE","_total","convertSpanToArray","total","OFFSET","ROWSPANTOTAL","COLSPANTOTAL","rowLength","handleIgnore","handleEmpty","handleRowSpan","rowSpan","colSpan","handledByColSpan","countRowSpan","countColSpan","totalRowSpan","totalColSpan","irStart","irEnd","icStart","icEnd","_row","handleColSpan","max","_re","handleMerge","irs","ics","ire","ice","merge","_matches","hasAttribute","isMobile","ua","navigator","userAgent","vendor","window","opera","Object","keys","_toArray","filter","_defined","id","hash","char","toString","prevFn","fn","curFn","removeEventListener","addEventListener","args","arguments","hasOwnProperty","els","slice","_hasClass","cls","classList","contains","selector","_numeric","apply","hasDependencies","msg","console","error","Error","config","tableExport","prop"],"mappings":"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","file":"tableexport.js","sourcesContent":["/*!\n * TableExport.js v5.0.0 (https://www.travismclarke.com)\n *\n * Copyright (c) 2018 - Travis Clarke - https://www.travismclarke.com\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n\n * http://www.apache.org/licenses/LICENSE-2.0\n\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\n\n;(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(function (require) {\n            var $;\n            try {\n                $ = require('jquery')\n            } catch (e) {\n            }\n            return factory($, require('blobjs'), require('file-saverjs'), require('xlsx'));\n        });\n    } else if (typeof exports === 'object' && typeof exports.nodeName !== 'string') {\n        // CommonJS\n        var $;\n        try {\n            $ = require('jquery')\n        } catch (e) {\n        }\n        module.exports = factory($, require('blobjs'), require('file-saverjs'), require('xlsx'));\n    } else {\n        // Browser globals\n        root.TableExport = factory(root.jQuery, root.Blob, root.saveAs, root.XLSX);\n    }\n}(this, function ($, Blob, saveAs, XLSX) {\n        'use strict';\n        /**\n         * TableExport main library constructor\n         * @param selectors {jQuery} jQuery selector(s)\n         * @param options {Object} TableExport configuration options\n         * @constructor\n         */\n        var TableExport = function (selectors, options) {\n            var self = this;\n\n            if (!selectors) return _handleError('\"selectors\" is required. \\nUsage: TableExport(selectors, options)');\n            if (!self) return new TableExport(selectors, options);\n\n            /**\n             * TableExport configuration options (user-defined w/ default fallback)\n             */\n            self.settings = _extend({}, self.defaults, options);\n            /**\n             * Selectors (tables) to apply the library to\n             */\n            self.selectors = _nodesArray(selectors);\n\n            var settings = self.settings;\n            settings.ignoreRows = settings.ignoreRows instanceof Array ? settings.ignoreRows : [settings.ignoreRows];\n            settings.ignoreCols = settings.ignoreCols instanceof Array ? settings.ignoreCols : [settings.ignoreCols];\n            settings.ignoreCSS = self.ignoreCSS instanceof Array ? self.ignoreCSS : [self.ignoreCSS];\n            settings.emptyCSS = self.emptyCSS instanceof Array ? self.emptyCSS : [self.emptyCSS];\n            settings.formatValue = self.formatValue.bind(this, settings.trimWhitespace);\n            settings.bootstrapSettings = _getBootstrapSettings(settings.bootstrap, self.bootstrapConfig, self.defaultButton);\n\n            var _exportData = {};\n            self.getExportData = function () {\n                return _exportData;\n            };\n\n            self.selectors.forEach(function (el) {\n                var context = {};\n\n                context.rows = _nodesArray(el.querySelectorAll('tbody > tr'));\n                context.rows = settings.headers ? _nodesArray(el.querySelectorAll('thead > tr')).concat(context.rows) : context.rows;\n                context.rows = settings.footers ? context.rows.concat(_nodesArray(el.querySelectorAll('tfoot > tr'))) : context.rows;\n                context.thAdj = settings.headers ? el.querySelectorAll('thead > tr').length : 0;\n                context.filename = settings.filename === 'id'\n                    ? (el.getAttribute('id') ? el.getAttribute('id') : self.defaultFilename)\n                    : (settings.filename ? settings.filename : self.defaultFilename);\n                context.uuid = _uuid(el);\n\n                /**\n                 * Initializes table caption with export buttons\n                 * @param exportButton {HTMLButtonElement}\n                 */\n                context.checkCaption = function (exportButton) {\n                    var caption = el.querySelectorAll('caption.' + self.defaultCaptionClass);\n                    if (caption.length) {\n                        caption[0].appendChild(exportButton);\n                    } else {\n                        caption = document.createElement('caption');\n                        caption.className = settings.bootstrapSettings.bootstrapSpacing + settings.position + ' ' + self.defaultCaptionClass;\n                        caption.appendChild(exportButton);\n                        el.insertBefore(caption, el.firstChild);\n                    }\n                };\n\n                context.setExportData = (function () {\n                    return function (exporter) {\n                        var data = Storage.getInstance().getItem(exporter);\n                        var type = exporter.substring(exporter.indexOf('-') + 1);\n                        _exportData[context.uuid] = _exportData[context.uuid] || {};\n                        _exportData[context.uuid][type] = JSON.parse(data);\n                    };\n                })();\n\n                context.rcMap = new RowColMap().build(context, settings);\n\n                var formatMap = _FORMAT_LIST\n                    .reduce(function (acc, cur) {\n                        acc[cur] = 0;\n                        return acc;\n                    }, {});\n\n                settings.formats.forEach(\n                    function (key) {\n                        if (!_isValidFormat(key)) {\n                            return _handleError('\"' + key + '\" is not a valid format. \\nFormats: ' + _FORMAT_LIST.join(', '))\n                        } else if (!_hasDependencies(key)) {\n                            // TODO: provide a fallback option to XLS?\n                            return _handleError('\"' + key + '\" requires \"js-xlsx\".');\n                        } else if (!formatMap[key]) {\n                            context.setExportData(self.exporters.build.call(self, context, key));\n                            formatMap[key]++;\n                        }\n                    }\n                );\n            });\n\n            var exportButton = document.querySelectorAll('button[' + self.storageKey + ']');\n            _on(exportButton, 'click', self.downloadHandler, self);\n\n            return self;\n        };\n\n        TableExport.prototype = {\n            /**\n             * Version.\n             * @memberof TableExport.prototype\n             */\n            version: '5.0.0',\n            /**\n             * Default library options.\n             * @memberof TableExport.prototype\n             */\n            defaults: {\n                headers: true,                              // (Boolean), display table headers (th or td elements) in the <thead>, (default: true)\n                footers: true,                              // (Boolean), display table footers (th or td elements) in the <tfoot>, (default: false)\n                formats: ['xlsx', 'csv', 'txt'],            // (String[]), filetype(s) for the export, (default: ['xlsx', 'csv', 'txt'])\n                filename: 'id',                             // (id, String), filename for the downloaded file, (default: 'id')\n                bootstrap: false,                           // (Boolean), style buttons using bootstrap, (default: true)\n                exportButtons: true,                        // (Boolean), automatically generate the built-in export buttons for each of the specified formats (default: true)\n                position: 'bottom',                         // (top, bottom), position of the caption element relative to table, (default: 'bottom')\n                ignoreRows: null,                           // (Number, Number[]), row indices to exclude from the exported file(s) (default: null)\n                ignoreCols: null,                           // (Number, Number[]), column indices to exclude from the exported file(s) (default: null)\n                trimWhitespace: true                        // (Boolean), remove all leading/trailing newlines, spaces, and tabs from cell text in the exported file(s) (default: false)\n            },\n            /**\n             * Constants\n             * @memberof TableExport.prototype\n             */\n            CONSTANTS: {\n                FORMAT: {\n                    XLSX: 'xlsx',\n                    XLSM: 'xlsm',\n                    XLSB: 'xlsb',\n                    BIFF2: 'biff2',\n                    XLS: 'xls',\n                    CSV: 'csv',\n                    TXT: 'txt'\n                },\n                TYPE: {\n                    STRING: 's',\n                    NUMBER: 'n',\n                    BOOLEAN: 'b',\n                    DATE: 'd'\n                }\n            },\n            /**\n             * Character set (character encoding) of the HTML.\n             * @memberof TableExport.prototype\n             */\n            charset: 'charset=utf-8',\n            /**\n             * Filename fallback for exported files.\n             * @memberof TableExport.prototype\n             */\n            defaultFilename: 'myDownload',\n            /**\n             * Class applied to each export button element.\n             * @memberof TableExport.prototype\n             */\n            defaultButton: 'button-default',\n            /**\n             * Class applied to each table caption.\n             * @memberof TableExport.prototype\n             */\n            defaultCaptionClass: 'tableexport-caption',\n            /**\n             * Namespace (i.e. prefix) applied to each table UUID and Storage key.\n             * @memberof TableExport.prototype\n             */\n            defaultNamespace: 'tableexport-',\n            /**\n             * Attribute applied to each table element used to generate each Storage key.\n             * @memberof TableExport.prototype\n             */\n            tableKey: 'tableexport-key',\n            /**\n             * Attribute applied to each export button element used to reference a Storage key.\n             * @memberof TableExport.prototype\n             */\n            storageKey: 'tableexport-id',\n            /**\n             * CSS selector or selector[] to exclude/remove cells from the exported file(s).\n             * @type {selector|selector[]}\n             * @memberof TableExport.prototype\n             */\n            ignoreCSS: '.tableexport-ignore',\n            /**\n             * CSS selector or selector[] to replace cells with an empty string in the exported file(s).\n             * @type {selector|selector[]}\n             * @memberof TableExport.prototype\n             */\n            emptyCSS: '.tableexport-empty',\n            /**\n             * Bootstrap configuration classes ['base', 'theme', 'container'].\n             * @memberof TableExport.prototype\n             */\n            bootstrapConfig: ['btn', 'btn-default', 'btn-toolbar'],\n            /**\n             * Row delimeter\n             * @memberof TableExport.prototype\n             */\n            rowDel: '\\r\\n',\n            /**\n             * HTML entity mapping for special characters.\n             * @memberof TableExport.prototype\n             */\n            entityMap: {'&': '&#38;', '<': '&#60;', '>': '&#62;', \"'\": '&#39;', '/': '&#47;'},\n            /**\n             * Format configuration\n             * @memberof TableExport.prototype\n             */\n            formatConfig: {\n                /**\n                 * XLSX (Open XML spreadsheet) file extension configuration\n                 * @memberof TableExport.prototype\n                 */\n                xlsx: {\n                    defaultClass: 'xlsx',\n                    buttonContent: 'Export to xlsx',\n                    mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n                    fileExtension: '.xlsx'\n                },\n                xlsm: {\n                    defaultClass: 'xlsm',\n                    buttonContent: 'Export to xlsm',\n                    mimeType: 'application/vnd.ms-excel.sheet.macroEnabled.main+xml',\n                    fileExtension: '.xlsm'\n                },\n                xlsb: {\n                    defaultClass: 'xlsb',\n                    buttonContent: 'Export to xlsb',\n                    mimeType: 'application/vnd.ms-excel.sheet.binary.macroEnabled.main',\n                    fileExtension: '.xlsb'\n                },\n                /**\n                 * XLS (Binary spreadsheet) file extension configuration\n                 * @memberof TableExport.prototype\n                 */\n                xls: {\n                    defaultClass: 'xls',\n                    buttonContent: 'Export to xls',\n                    separator: '\\t',\n                    mimeType: 'application/vnd.ms-excel',\n                    fileExtension: '.xls',\n                    enforceStrictRFC4180: false\n                },\n                /**\n                 * CSV (Comma Separated Values) file extension configuration\n                 * @memberof TableExport.prototype\n                 */\n                csv: {\n                    defaultClass: 'csv',\n                    buttonContent: 'Export to csv',\n                    separator: ',',\n                    mimeType: 'text/csv',\n                    fileExtension: '.csv',\n                    enforceStrictRFC4180: true\n                },\n                /**\n                 * TXT (Plain Text) file extension configuration\n                 * @memberof TableExport.prototype\n                 */\n                txt: {\n                    defaultClass: 'txt',\n                    buttonContent: 'Export to txt',\n                    separator: '  ',\n                    mimeType: 'text/plain',\n                    fileExtension: '.txt',\n                    enforceStrictRFC4180: true\n                }\n            },\n            /**\n             * Cell-types override and assertion configuration\n             * @memberof TableExport.prototype\n             */\n            typeConfig: {\n                string: {\n                    defaultClass: 'tableexport-string'\n                },\n                number: {\n                    defaultClass: 'tableexport-number',\n                    assert: function (v) {\n                        return !isNaN(v);\n                    }\n                },\n                boolean: {\n                    defaultClass: 'tableexport-boolean',\n                    assert: function (v) {\n                        return v.toLowerCase() === 'true' || v.toLowerCase() === 'false';\n                    }\n                },\n                date: {\n                    defaultClass: 'tableexport-date',\n                    assert: function (v) {\n                        return !(/.*%/.test(v)) && !isNaN(Date.parse(v))\n                    }\n                }\n            },\n            exporters: {\n                build: function (context, key) {\n                    var self = this;\n                    var settings = self.settings;\n                    var format = self.formatConfig[key];\n                    var colDel = format.separator;\n                    var rcMap = context.rcMap;\n\n                    var getReturn = function (val) {\n                        if (_isEnhanced(key)) {\n                            return {\n                                v: settings.formatValue(val.textContent),\n                                t: self.getType(val.className)\n                            }\n                        }\n                        switch (key) {\n                            case _FORMAT.CSV:\n                                return '\"' + settings.formatValue(val.textContent.replace(/\"/g, '\"\"')) + '\"';\n                            default:\n                                return settings.formatValue(val.textContent);\n                        }\n                    };\n\n                    var dataURI = _nodesArray(context.rows).map(function (val, ir) {\n                        if (rcMap.isIgnore(ir)) {\n                            return rcMap.handleRowColMapProp(rcMap.TYPE.IGNORE);\n                        } else if (rcMap.isEmpty(ir)) {\n                            return rcMap.handleRowColMapProp(rcMap.TYPE.EMPTY);\n                        }\n                        var cols = val.querySelectorAll('th, td');\n                        return _nodesArray(cols).map(function (val, ic) {\n                            var _return = getReturn(val);\n                            if (rcMap.isIgnore(ir, ic)) {\n                                return rcMap.handleRowColMapProp(rcMap.TYPE.IGNORE);\n                            } else if (rcMap.isEmpty(ir, ic)) {\n                                return rcMap.handleRowColMapProp(rcMap.TYPE.EMPTY);\n                            } else {\n                                return rcMap.handleRowColMapProp(rcMap.TYPE.DEFAULT, ir, ic, key, _return, colDel);\n                            }\n                        }).processCols(key, colDel);\n                    }).processRows(key, self.rowDel);\n\n                    var dataObject = JSON.stringify({\n                        data: dataURI,\n                        filename: context.filename,\n                        mimeType: format.mimeType,\n                        fileExtension: format.fileExtension,\n                        merges: rcMap.merges\n                    });\n\n                    var hashKey = _hashCode({uuid: context.uuid, type: key});\n\n                    settings.exportButtons && context.checkCaption(self.createObjButton(\n                        hashKey,\n                        dataObject,\n                        format.buttonContent,\n                        format.defaultClass,\n                        settings.bootstrapSettings\n                    ));\n                    return Storage.getInstance().setItem(hashKey, dataObject, true);\n                }\n            },\n            /**\n             * Creates file export buttons\n             * @param hashKey {String}\n             * @param dataObject {String}\n             * @param myContent {String}\n             * @param myClass {String}\n             * @param bootstrapSettings {Object}\n             * @returns Element\n             */\n            createObjButton: function (hashKey, dataObject, myContent, myClass, bootstrapSettings) {\n                var exportButton = document.createElement('button');\n                exportButton.setAttribute(this.storageKey, hashKey);\n                exportButton.className = bootstrapSettings.bootstrapClass + bootstrapSettings.bootstrapTheme + myClass;\n                exportButton.textContent = myContent;\n                return exportButton\n            },\n            /**\n             * Escapes special characters with HTML entities\n             * @memberof TableExport.prototype\n             * @param string {String}\n             * @returns {String} escaped string\n             */\n            escapeHtml: function (string) {\n                var self = this;\n                return String(string).replace(/[&<>'\\/]/g, function (s) {\n                    return self.entityMap[s];\n                });\n            },\n            /**\n             * Unescapes HTML entities to special characters\n             * @memberof TableExport.prototype\n             * @param string {String}\n             * @returns {String} unescaped string\n             */\n            unescapeHtml: function (string) {\n                var str = String(string);\n                for (var key in this.entityMap) {\n                    str = str.replace(RegExp(this.entityMap[key], 'g'), key);\n                }\n                return str;\n            },\n            /**\n             * Removes leading/trailing whitespace from cell string\n             * @param isTrimWhitespace {Boolean}\n             * @param string {String}\n             * @returns {String} trimmed string\n             */\n            formatValue: function (isTrimWhitespace, string) {\n                return isTrimWhitespace ? string.trim() : string;\n            },\n            /**\n             * Get cell data-type\n             * @param string {String}\n             * @returns {String} data-type\n             */\n            getType: function (string) {\n                if (!string) return '';\n                var types = this.typeConfig;\n                if (~string.indexOf(types.string.defaultClass)) {\n                    return _TYPE.STRING;\n                } else if (~string.indexOf(types.number.defaultClass)) {\n                    return _TYPE.NUMBER;\n                } else if (~string.indexOf(types.boolean.defaultClass)) {\n                    return _TYPE.BOOLEAN;\n                } else if (~string.indexOf(types.date.defaultClass)) {\n                    return _TYPE.DATE;\n                } else {\n                    return '';\n                }\n            },\n            /**\n             * Formats datetimes for compatibility with Excel\n             * @memberof TableExport.prototype\n             * @param v {Number}\n             * @param date1904 {Date}\n             * @returns {Number} epoch time\n             */\n            dateNum: function (v, date1904) {\n                if (date1904) v += 1462;\n                var epoch = Date.parse(v);\n                var result = (epoch - new Date(Date.UTC(1899, 11, 30))) / (24 * 60 * 60 * 1000);\n                return Math.floor(result);\n            },\n            /**\n             * Creates an Excel spreadsheet from a data string\n             * @memberof TableExport.prototype\n             * @param data {String}\n             * @param merges {Object[]}\n             */\n            createSheet: function (data, merges) {\n                var ws = {};\n                var range = {s: {c: 10000000, r: 10000000}, e: {c: 0, r: 0}};\n                var types = this.typeConfig;\n                for (var R = 0; R !== data.length; ++R) {\n                    for (var C = 0; C !== data[R].length; ++C) {\n                        if (range.s.r > R) range.s.r = R;\n                        if (range.s.c > C) range.s.c = C;\n                        if (range.e.r < R) range.e.r = R;\n                        if (range.e.c < C) range.e.c = C;\n                        var cell = data[R][C];\n                        if (!cell || !cell.v) continue;\n                        var cell_ref = XLSX.utils.encode_cell({c: C, r: R});\n\n                        if (!cell.t) {\n                            if (types.number.assert(cell.v)) cell.t = _TYPE.NUMBER;\n                            else if (types.boolean.assert(cell.v)) cell.t = _TYPE.BOOLEAN;\n                            else if (types.date.assert(cell.v)) cell.t = _TYPE.DATE;\n                            else cell.t = _TYPE.STRING;\n                        }\n                        if (cell.t === _TYPE.DATE) {\n                            cell.t = _TYPE.NUMBER;\n                            cell.z = XLSX.SSF._table[14];\n                            cell.v = this.dateNum(cell.v);\n                        }\n                        ws[cell_ref] = cell;\n                    }\n                }\n                ws['!merges'] = merges;\n                if (range.s.c < 10000000) ws['!ref'] = XLSX.utils.encode_range(range);\n                return ws;\n            },\n            /**\n             * Click handler for export button \"download\"\n             * @memberof TableExport.prototype\n             */\n            downloadHandler: function (event) {\n                var target = event.target;\n                var object = JSON.parse(Storage.getInstance().getItem(target.getAttribute(this.storageKey))),\n                    data = object.data,\n                    filename = object.filename,\n                    mimeType = object.mimeType,\n                    fileExtension = object.fileExtension,\n                    merges = object.merges;\n                this.export2file(data, mimeType, filename, fileExtension, merges);\n            },\n            /**\n             * Excel Workbook constructor\n             * @memberof TableExport.prototype\n             * @constructor\n             */\n            Workbook: function () {\n                this.SheetNames = [];\n                this.Sheets = {};\n            },\n            /**\n             * Converts a string to an arraybuffer\n             * @param s {String}\n             * @memberof TableExport.prototype\n             * @returns {ArrayBuffer}\n             */\n            string2ArrayBuffer: function (s) {\n                var buf = new ArrayBuffer(s.length);\n                var view = new Uint8Array(buf);\n                for (var i = 0; i !== s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;\n                return buf;\n            },\n            /**\n             * Exports and downloads the file\n             * @memberof TableExport.prototype\n             * @param data {String}\n             * @param mime {String} mime type\n             * @param name {String} filename\n             * @param extension {String} file extension\n             * @param merges {Object[]}\n             */\n            export2file: function (data, mime, name, extension, merges) {\n                data = this.getRawData(data, extension, name, merges);\n\n                if (_isMobile) {\n                    // TODO: fix dataURI on iphone (xlsx & xls)\n                    var dataURI = 'data:' + mime + ';' + this.charset + ',' + data;\n                    this.downloadDataURI(dataURI, name, extension);\n                } else {\n                    // TODO: error and fallback when `saveAs` not available\n                    saveAs(new Blob([data],\n                        {type: mime + ';' + this.charset}),\n                        name + extension, true);\n                }\n            },\n            downloadDataURI: function (dataURI, name, extension) {\n                var encodedUri = encodeURI(dataURI);\n                var link = document.createElement('a');\n                link.setAttribute('href', encodedUri);\n                link.setAttribute('download', name + extension);\n                document.body.appendChild(link);\n                link.click();\n            },\n            getBookType: function (key) {\n                switch (key) {\n                    case _FORMAT.XLS:\n                        return _FORMAT.BIFF2;\n                    default:\n                        return key;\n                }\n            },\n            getRawData: function (data, extension, name, merges) {\n                var key = extension.substring(1);\n\n                if (_isEnhanced(key)) {\n                    var wb = new this.Workbook(),\n                        ws = this.createSheet(data, merges),\n                        bookType = this.getBookType(key);\n\n                    name = name || '';\n                    wb.SheetNames.push(name);\n                    wb.Sheets[name] = ws;\n                    var wopts = {\n                            bookType: bookType,\n                            bookSST: false,\n                            type: 'binary'\n                        },\n                        wbout = XLSX.write(wb, wopts);\n\n                    data = this.string2ArrayBuffer(wbout);\n                }\n                return data;\n            },\n            getFileSize: function (data, extension) {\n                var binary = this.getRawData(data, extension);\n                return binary instanceof ArrayBuffer\n                    ? binary.byteLength\n                    : this.string2ArrayBuffer(binary).byteLength;\n            },\n            /**\n             * Updates the library instance with new/updated options\n             * @param options {Object} TableExport configuration options\n             * @returns {TableExport} updated TableExport instance\n             */\n            update: function (options) {\n                this.remove();\n                return new TableExport(this.selectors, _extend({}, this.defaults, options));\n            },\n            /**\n             * Reset the library instance to its original state\n             * @returns {TableExport} original TableExport instance\n             */\n            reset: function () {\n                this.remove();\n                return new TableExport(this.selectors, this.settings);\n            },\n            /**\n             * Remove the instance (i.e. caption containing the export buttons)\n             */\n            remove: function () {\n                var self = this;\n                this.selectors.forEach(function (el) {\n                    var caption = el.querySelector('caption.' + self.defaultCaptionClass);\n                    caption && el.removeChild(caption);\n                });\n            }\n        };\n\n        /**\n         * Storage main interface constructor\n         * @memberof TableExport.prototype\n         * @constructor\n         */\n        var Storage = function () {\n            this._instance = null;\n\n            this.store = sessionStorage;\n            this.namespace = TableExport.prototype.defaultNamespace;\n            this.getKey = function (key) {\n                return this.namespace + key;\n            };\n            this.setItem = function (_key, value, overwrite) {\n                var key = this.getKey(_key);\n                if (this.exists(_key) && !overwrite) {\n                    return;\n                }\n                if (typeof value !== 'string') return _handleError('\"value\" must be a string.');\n                this.store.setItem(key, value);\n                return _key;\n            };\n            this.getItem = function (_key) {\n                var key = this.getKey(_key);\n                return this.store.getItem(key);\n            };\n            this.exists = function (_key) {\n                var key = this.getKey(_key);\n                return this.store.getItem(key) !== null;\n            };\n            this.removeItem = function (_key) {\n                var key = this.getKey(_key);\n                return this.store.removeItem(key);\n            };\n        };\n        Storage.getInstance = function () {\n            if (!this._instance) {\n                this._instance = new Storage();\n            }\n            return this._instance;\n        };\n\n        /**\n         * RowColMap main interface constructor\n         * @memberof TableExport.prototype\n         * @constructor\n         */\n        var RowColMap = function () {\n            this.rcMap = [];\n            this.merges = [];\n\n            this.isIgnore = function (ir, ic) {\n                var _ignore = RowColMap.prototype.TYPE.IGNORE;\n                return this.getRowColMapProp(ir, ic, _ignore);\n            };\n            this.isEmpty = function (ir, ic) {\n                var _empty = RowColMap.prototype.TYPE.EMPTY;\n                return this.getRowColMapProp(ir, ic, _empty);\n            };\n            this.isRowSpan = function (ir) {\n                var _rowspan = RowColMap.prototype.TYPE.ROWSPAN;\n                return this.getRowColMapProp(ir, undefined, _rowspan);\n            };\n            this.isColSpan = function (ir) {\n                var _colspan = RowColMap.prototype.TYPE.COLSPAN;\n                return this.getRowColMapProp(ir, undefined, _colspan);\n            };\n            this.isSpan = function (ir) {\n                return this.isRowSpan(ir) || this.isColSpan(ir);\n            };\n            this.isMerge = function (ir) {\n                return this.merges.length > 0;\n            };\n            this.addMerge = function (ir, mergeObj) {\n                var _merge = RowColMap.prototype.TYPE.MERGE;\n                this.merges.push(mergeObj);\n                this.setRowColMapProp(ir, undefined, _merge, this.merges);\n            };\n            this.getRowColMapProp = function (ir, ic, key) {\n                if (this.rcMap[ir]) {\n                    if (typeof key === 'undefined') {\n                        return this.rcMap[ir][ic];\n                    } else if (typeof ic === 'undefined') {\n                        return this.rcMap[ir][key];\n                    } else if (this.rcMap[ir][ic]) {\n                        return this.rcMap[ir][ic][key];\n                    }\n                }\n                return undefined;\n            };\n            this.setRowColMapProp = function (ir, ic, key, value) {\n                this.rcMap[ir] = this.rcMap[ir] || [];\n                if (typeof key === 'undefined') {\n                    return this.rcMap[ir][ic] = value;\n                } else if (typeof ic === 'undefined') {\n                    return this.rcMap[ir][key] = value;\n                } else {\n                    this.rcMap[ir][ic] = this.rcMap[ir][ic] || [];\n                    return this.rcMap[ir][ic][key] = value;\n                }\n            };\n            this.generateTotal = function (ir, ic) {\n                var VALUE = RowColMap.prototype.TYPE.VALUE;\n                var _total = 0;\n\n                if (this.isRowSpan(ir) && this.isColSpan(ir)) {\n                    _total = this.getRowColMapProp(ir, ic, VALUE) || 0;\n                } else if (this.getRowColMapProp(ir, ic, VALUE)) {\n                    _total = this.getRowColMapProp(ir, ic, VALUE);\n                }\n                return _total;\n            };\n            this.convertSpanToArray = function (ir, ic, key, _return, colDel) {\n                if (this.rcMap[ir] && this.isSpan(ir)) {\n                    var total = this.generateTotal(ir, ic);\n\n                    if (_isEnhanced(key)) {\n                        return new Array(total).concat(_return);\n                    } else {\n                        return new Array(total).concat(_return).join(colDel);\n                    }\n                }\n                return _return;\n            };\n            this.handleRowColMapProp = function (type, ir, ic, key, _return, colDel) {\n                switch (type) {\n                    case RowColMap.prototype.TYPE.IGNORE:\n                        return;\n                    case RowColMap.prototype.TYPE.EMPTY:\n                        return ' ';\n                    case RowColMap.prototype.TYPE.DEFAULT:\n                    default:\n                        return this.convertSpanToArray(ir, ic, key, _return, colDel);\n                }\n            };\n        };\n        RowColMap.prototype = {\n            OFFSET: 1,\n            TYPE: {\n                IGNORE: 'ignore',\n                EMPTY: 'empty',\n                MERGE: 'merge',\n                ROWSPAN: 'rowspan',\n                ROWSPANTOTAL: 'rowspantotal',\n                COLSPAN: 'colspan',\n                COLSPANTOTAL: 'colspantotal',\n                DEFAULT: 'default',\n                VALUE: 'value'\n            },\n            build: function (context, settings) {\n                var self = this;\n\n                var OFFSET = self.OFFSET;\n                var rowLength = self.rowLength = context.rows.length;\n                // var colLength = self.colLength = Math.max.apply(null,\n                //     _nodesArray(context.rows).map(function (val) {\n                //         return val.querySelectorAll('th, td').length\n                //     }));\n\n                var handleIgnore = function (ir, ic) {\n                    self.setRowColMapProp(ir, ic, self.TYPE.IGNORE, true);\n                };\n                var handleEmpty = function (ir, ic) {\n                    self.setRowColMapProp(ir, ic, self.TYPE.EMPTY, true);\n                };\n                var handleRowSpan = function (val, ir, ic) {\n                    var rowSpan = +val.getAttribute('rowspan');\n                    var colSpan = +val.getAttribute('colspan');\n                    var handledByColSpan,\n                        countRowSpan, countColSpan,\n                        totalRowSpan, totalColSpan,\n                        irStart, irEnd, icStart, icEnd;\n\n                    for (var _row = 0; _row < rowSpan; _row++) {\n                        if (_row + ir >= rowLength) {\n                            return;\n                        }\n                        colSpan && (handledByColSpan = handleColSpan(val, _row + ir, ic, _row > 0, rowSpan));\n\n                        if (rowSpan <= 1) {\n                            return false;\n                        }\n                        var cur = self.rcMap['c' + (ic - 1)] ? self.rcMap['c' + (ic - 1)][_row + ir] : 0;\n                        if (cur) {\n                            self.rcMap['c' + (ic)] = self.rcMap['c' + (ic)] || [];\n                            self.rcMap['c' + (ic)][_row + ir] = (self.rcMap['c' + (ic)][_row + ir] || 0) + cur;\n                        }\n\n                        if (rowSpan && _row === 0 && colSpan > 1) {\n                            for (var i = 0; i < rowSpan; i++) {\n                                self.rcMap['c' + (ic + 1)] = self.rcMap['c' + (ic + 1)] || [];\n                                self.rcMap['c' + (ic + 1)][_row + ir + i] = (self.rcMap['c' + (ic + 1)][_row + ir + i] || 0) + Math.max(1, colSpan);\n\n                            }\n                        }\n\n                        if (_row >= 1) {\n                            countRowSpan = self.getRowColMapProp(_row + ir, undefined, self.TYPE.ROWSPAN) || 0;\n                            self.setRowColMapProp(_row + ir, undefined, self.TYPE.ROWSPAN, countRowSpan + 1);\n\n                            if (!handledByColSpan) {\n                                totalRowSpan = self.getRowColMapProp(_row + ir, ic - countRowSpan, self.TYPE.VALUE) || 0;\n                                self.setRowColMapProp(_row + ir, ic - countRowSpan, self.TYPE.VALUE, totalRowSpan + 1);\n                                if (rowSpan > 1 && _row === 1) {\n                                    var _re = self.rcMap['c' + (ic)] && self.rcMap['c' + (ic)][_row + ir];\n                                    totalColSpan = self.getRowColMapProp(ir, undefined, self.TYPE.COLSPANTOTAL) || 0;\n                                    countColSpan = self.getRowColMapProp(ir, undefined, self.TYPE.COLSPAN) || 0;\n                                    irStart = ir;\n                                    irEnd = ir + rowSpan - 1;\n                                    icStart = ic + totalColSpan - countColSpan + (_re || 0);\n                                    icEnd = icStart + Math.max(1, colSpan) - 1;\n                                    handleMerge(irStart, icStart, irEnd, icEnd);\n                                }\n                            }\n                        }\n                    }\n                };\n\n                var handleColSpan = function (val, ir, ic, isRowSpan, rowSpan) {\n                    var irStart, irEnd, icStart, icEnd;\n                    var colSpan = +val.getAttribute('colspan');\n                    var countColSpan = self.getRowColMapProp(ir, undefined, self.TYPE.COLSPAN) || 0;\n                    var totalColSpan = self.getRowColMapProp(ir, undefined, self.TYPE.COLSPANTOTAL) || 0;\n\n                    if (colSpan <= 1) {\n                        return false;\n                    }\n\n                    self.setRowColMapProp(ir, undefined, self.TYPE.COLSPAN, countColSpan + 1);\n                    self.setRowColMapProp(ir, undefined, self.TYPE.COLSPANTOTAL, totalColSpan + colSpan);\n\n                    if (isRowSpan) {\n                        self.setRowColMapProp(ir, ic - countColSpan, self.TYPE.VALUE, colSpan);\n                        return true;\n                    } else {\n                        irStart = ir;\n                        irEnd = ir + (rowSpan || 1) - OFFSET;\n                        icStart = ic + totalColSpan - countColSpan;\n                        icEnd = ic + totalColSpan - countColSpan + (colSpan - OFFSET);\n                        self.setRowColMapProp(ir, ic + OFFSET, self.TYPE.VALUE, colSpan - OFFSET);\n                        handleMerge(irStart, icStart, irEnd, icEnd);\n                    }\n                };\n\n                var handleMerge = function (irs, ics, ire, ice) {\n                    var merge = {\n                        s: {r: irs, c: ics},\n                        e: {r: ire, c: ice}\n                    };\n                    return self.addMerge(irs, merge);\n                };\n\n                _nodesArray(context.rows).map(function (val, ir) {\n                    if (!!~settings.ignoreRows.indexOf(ir - context.thAdj) || _matches(val, settings.ignoreCSS)) {\n                        handleIgnore(ir);\n                    }\n                    if (_matches(val, settings.emptyCSS)) {\n                        handleEmpty(ir);\n                    }\n                    var cols = val.querySelectorAll('th, td');\n                    return _nodesArray(cols).map(function (val, ic) {\n                        if (!!~settings.ignoreCols.indexOf(ic) || _matches(val, settings.ignoreCSS)) {\n                            handleIgnore(ir, ic);\n                        }\n                        if (_matches(val, settings.emptyCSS)) {\n                            handleEmpty(ir, ic);\n                        }\n                        if (val.hasAttribute('rowspan')) {\n                            handleRowSpan(val, ir, ic);\n                        } else if (val.hasAttribute('colspan')) {\n                            handleColSpan(val, ir, ic);\n                        }\n                    });\n                });\n\n                return self;\n            }\n        };\n\n        var _isMobile = (function isMobile(ua) {\n            return /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(ua)\n                || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(ua.substring(0, 4))\n        })(navigator.userAgent || navigator.vendor || window.opera);\n\n        var _isEnhanced = (function () {\n            return function (key) {\n                return (\n                    XLSX\n                    && !_isMobile\n                    && !(TableExport.prototype.formatConfig[key].enforceStrictRFC4180)\n                );\n            }\n        })();\n\n        var _FORMAT = (function () {\n            return TableExport.prototype.CONSTANTS.FORMAT;\n        })();\n\n        var _FORMAT_LIST = (function () {\n            return Object.keys(_FORMAT).map(function (key) {\n                return _FORMAT[key];\n            });\n        })();\n\n        var _TYPE = (function () {\n            return TableExport.prototype.CONSTANTS.TYPE;\n        })();\n\n        Array.prototype.processRows = function (key, rowDel) {\n            if (_isEnhanced(key)) {\n                return this.map(_toArray).filter(_defined);\n            } else {\n                return this.filter(_defined).join(rowDel);\n            }\n        };\n        Array.prototype.processCols = function (key, colDel) {\n            if (_isEnhanced(key)) {\n                return this.filter(_defined);\n            } else {\n                return this.filter(_defined).join(colDel);\n            }\n        };\n\n        var _uuid = (function () {\n            var uuid = 0;\n\n            return function (el) {\n                var tableKey = el.getAttribute(TableExport.prototype.tableKey);\n\n                if (!tableKey) {\n                    tableKey = el.id\n                        ? el.id\n                        : TableExport.prototype.defaultNamespace + (++uuid);\n                    el.setAttribute(TableExport.prototype.tableKey, tableKey);\n                }\n                return tableKey;\n            };\n        })();\n\n        var _hashCode = (function () {\n\n            return function (hashKey) {\n                var hash = 0, i, char;\n\n                var type = hashKey.type;\n                hashKey = JSON.stringify(hashKey);\n                if (hashKey.length === 0) return hash;\n                for (i = 0; i < hashKey.length; i++) {\n                    char = hashKey.charCodeAt(i);\n                    hash = ((hash << 5) - hash) + char;\n                    hash |= 0;\n                }\n                return hash.toString(16).substring(1) + '-' + type;\n            }\n        })();\n\n        var _on = (function () {\n            var prevFn = null;\n\n            return function (el, event, fn, context) { // , args\n                var curFn = fn.bind(context);\n                // var curFn = fn.bind.apply(fn, [context].concat(args)); // OR [].slice.call(arguments[4]))\n                for (var i = 0; i < el.length; ++i) {\n                    prevFn && el[i].removeEventListener(event, prevFn, false);\n                    el[i].addEventListener(event, curFn, false);\n                }\n                prevFn = curFn;\n            }\n        })();\n\n        function _extend() {\n            var args = arguments;\n            for (var i = 1; i < args.length; i++)\n                for (var key in args[i])\n                    if (args[i].hasOwnProperty(key))\n                        args[0][key] = args[i][key];\n            return args[0];\n        }\n\n        function _nodesArray(els) {\n            return (typeof els.length === 'undefined') ? [].concat(els) : [].slice.call(els);\n        }\n\n        function _hasClass(el, cls) {\n            return el.classList ? el.classList.contains(cls) : new RegExp('(^| )' + cls + '( |$)', 'gi').test(el.cls);\n        }\n\n        function _matches(el, selectors) {\n            return selectors.filter(function (selector) {\n                    return [].indexOf.call(document.querySelectorAll(selector), el) !== -1;\n                }).length > 0;\n        }\n\n        function _numeric(val) {\n            return !isNaN(val);\n        }\n\n        function _defined(val) {\n            return typeof val !== 'undefined';\n        }\n\n        function _toArray(val) {\n            return val instanceof Array ? [].concat.apply([], val) : val;\n        }\n\n        function _isValidFormat(key) {\n            return ~_FORMAT_LIST.indexOf(key);\n        }\n\n        function _hasDependencies(key) {\n            var hasDependencies;\n\n            switch (key) {\n                case _FORMAT.TXT:\n                case _FORMAT.CSV:\n                case _FORMAT.XLS:\n                    hasDependencies = true;\n                    break;\n                default:\n                    hasDependencies = _isEnhanced(key);\n            }\n            return hasDependencies\n        }\n\n        function _handleError(msg) {\n            console.error(msg);\n            return new Error(msg)\n        }\n\n        function _getBootstrapSettings(bootstrap, bootstrapConfig, defaultButton) {\n            var config = {};\n            if (bootstrap) {\n                config.bootstrapClass = bootstrapConfig[0] + ' ';\n                config.bootstrapTheme = bootstrapConfig[1] + ' ';\n                config.bootstrapSpacing = bootstrapConfig[2] + ' ';\n            } else {\n                config.bootstrapClass = defaultButton + ' ';\n                config.bootstrapTheme = '';\n                config.bootstrapSpacing = '';\n            }\n            return config;\n        }\n\n        if ($) {\n            /**\n             * jQuery TableExport wrapper\n             * @param options {Object} TableExport configuration options\n             * @returns {TableExport} TableExport instance\n             */\n            $.fn.tableExport = function (options) {\n                return new TableExport(this, options);\n            };\n\n            // alias the TableExport prototype\n            for (var prop in TableExport.prototype) {\n                $.fn.tableExport[prop] = TableExport.prototype[prop];\n            }\n        }\n\n        TableExport.TableExport = TableExport;\n\n        return TableExport;\n    }\n));\n"]}