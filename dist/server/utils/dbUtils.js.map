{"version":3,"sources":["../../../server/utils/dbUtils.js"],"names":["connect","createTender","listTenders","setNextURI","getNextURI","Tender","mongoose","model","NextURI","db","config","host","port","name","tender","find","_id","then","data","length","newTender","startDate","awardCriteria","tenderers","items","classification_ids","tenderID","title","amount","currency","valueAddedTaxIncluded","status","suppliers","save","err","doc","console","log","tenderFilter","callback","URI","findOne","nextURI","uri"],"mappings":"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","file":"dbUtils.js","sourcesContent":["import mongoose from 'mongoose';\nimport config from '../config/config.js';\nimport '../models/Tender';\nimport '../models/NextURI';\nimport errorHandler from '../errorHandler';\n\nconst Tender = mongoose.model('Tender');\nconst NextURI = mongoose.model('NextURI');\n\n\nexport function connect() {\n    const db = config.db;\n    mongoose.connect(`mongodb://${db.host}:${db.port}/${db.name}`);\n}\n\nexport function createTender(tender) {\n    Tender.find({_id: tender._id}).then(data => {\n        if (data.length === 0) {\n            const newTender = new Tender;\n            newTender._id = tender._id;\n            newTender.name = tender.name;\n            newTender.startDate = tender.startDate;\n            newTender.awardCriteria = tender.awardCriteria;\n            newTender.tenderers = tender.tenderers;\n            newTender.items = tender.items;\n            newTender.classification_ids = tender.classification_ids;\n            newTender.tenderID = tender.tenderID;\n            newTender.title = tender.title;\n            newTender.amount = tender.amount;\n            newTender.currency = tender.currency;\n            newTender.valueAddedTaxIncluded = tender.valueAddedTaxIncluded;\n            newTender.status = tender.status;\n            newTender.suppliers = tender.suppliers;\n            newTender.save(function (err, doc) {\n                if (err) {\n                    errorHandler(err);\n                } else {\n                    console.log(doc);\n                }\n            });\n        }\n    });\n}\n\nexport function listTenders(tenderFilter, callback) {\n    Tender.find(tenderFilter).then(data => callback(data));\n}\n\nexport function setNextURI(URI) {\n    NextURI.findOne({_id: 'nextURI'}, (err, doc) => {\n        if (doc) {\n            doc.nextURI = URI;\n            doc.save((err, doc) => {\n                if(err){\n                    errorHandler(err);\n                } else console.log(doc);\n            });\n\n        } else {\n            const uri = new NextURI;\n            uri._id = 'nextURI';\n            uri.nextURI = URI;\n            uri.save((err, doc) => {\n                if(err){\n                    errorHandler(err);\n                }\n            });\n        }\n    })\n}\n\nexport function getNextURI(callback) {\n    NextURI.findOne({_id: 'nextURI'}, (err, doc) => {\n        if (doc) {\n           callback(doc.nextURI);\n\n        } else {\n            callback(false);\n        }\n    });\n}"]}