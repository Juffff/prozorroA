{"version":3,"sources":["../../../server/utils/dbUtils.js"],"names":["connect","createTender","updateTender","listTenders","setNextURI","getNextURI","Tender","mongoose","model","NextURI","db","config","host","port","name","tender","find","_id","then","data","length","newTender","datePublished","startDate","awardCriteria","tenderers","items","classification_ids","tenderID","title","amount","currency","valueAddedTaxIncluded","status","suppliers","createdAt","Date","now","toLocaleDateString","toString","history","save","err","doc","console","log","tenderFilter","callback","URI","findOne","nextURI","uri"],"mappings":"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","file":"dbUtils.js","sourcesContent":["import mongoose from 'mongoose';\nimport config from '../config/config.js';\nimport '../models/Tender';\nimport '../models/NextURI';\nimport errorHandler from '../errorHandler';\n\nconst Tender = mongoose.model('Tender');\nconst NextURI = mongoose.model('NextURI');\n\n\nexport function connect() {\n    const db = config.db;\n    mongoose.connect(`mongodb://${db.host}:${db.port}/${db.name}`);\n}\n\nexport function createTender(tender) {\n    Tender.find({_id: tender._id}).then(data => {\n        if (data.length === 0) {\n            const newTender = new Tender;\n            newTender._id = tender._id;\n            newTender.name = tender.name;\n            newTender.datePublished = tender.datePublished;\n            newTender.startDate = tender.startDate;\n            newTender.awardCriteria = tender.awardCriteria;\n            newTender.tenderers = tender.tenderers;\n            newTender.items = tender.items;\n            newTender.classification_ids = tender.classification_ids;\n            newTender.tenderID = tender.tenderID;\n            newTender.title = tender.title;\n            newTender.amount = tender.amount;\n            newTender.currency = tender.currency;\n            newTender.valueAddedTaxIncluded = tender.valueAddedTaxIncluded;\n            newTender.status = tender.status;\n            newTender.suppliers = tender.suppliers;\n            newTender.createdAt = new Date(Date.now()).toLocaleDateString().toString();\n            newTender.history = {[new Date(Date.now()).toLocaleDateString().toString()] : 'Added to DB'};\n            newTender.save(function (err, doc) {\n                if (err) {\n                    errorHandler(err);\n                } else {\n                    console.log(doc);\n                }\n            });\n        } else {\n            updateTender(data, tender);\n        }\n    });\n}\n\nexport function updateTender(tender, data) {\n\n}\n\n\n\nexport function listTenders(tenderFilter, callback) {\n    Tender.find(tenderFilter).then(data => callback(data));\n}\n\nexport function setNextURI(URI) {\n    NextURI.findOne({_id: 'nextURI'}, (err, doc) => {\n        if (doc) {\n            doc.nextURI = URI;\n            doc.save((err, doc) => {\n                if(err){\n                    errorHandler(err);\n                }\n            });\n\n        } else {\n            const uri = new NextURI;\n            uri._id = 'nextURI';\n            uri.nextURI = URI;\n            uri.save((err, doc) => {\n                if(err){\n                    errorHandler(err);\n                }\n            });\n        }\n    })\n}\n\nexport function getNextURI(callback) {\n    NextURI.findOne({_id: 'nextURI'}, (err, doc) => {\n        if (doc) {\n           callback(doc.nextURI);\n\n        } else {\n            callback(false);\n        }\n    });\n}"]}