{"version":3,"sources":["../../../server/utils/tendersComparator.js"],"names":["oldTender","newTender","tenderDifferences","compareNames","names","compareStartDates","startDates","toString","comparePublishedDates","PublishedDates","compareIds","iDs","compareTitles","titles","compareAmounts","amounts","compareCurrencies","currencies","compareStatuses","statuses","compareTenderers","Object","assign","tenderers","compareSuppliers","suppliers","compareItems","items","compareClassification_ids","classification_ids","formatDate","date","Date","toLocaleDateString","name","startDate","datePublished","tenderID","title","Number","parseInt","amount","currency","status","compareArrays","oldArray","newArray","tOldArray","tNewArray","added","deleted","forEach","indexOf","el","push","length","compareArraysDesc","fName","description","compareResult","join"],"mappings":"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","file":"tendersComparator.js","sourcesContent":["function formatDate(date) {\n    return new Date(date).toLocaleDateString();\n}\n\nfunction compareNames(oldTender, newTender) {\n    if (oldTender.name === newTender.name) {\n        return 0;\n    } else {\n        return `Изменено имя: ${oldTender.name} -> ${newTender.name}`\n    }\n}\n\n\nfunction compareStartDates(oldTender, newTender) {\n    if (oldTender.startDate === newTender.startDate) {\n        return 0;\n    } else return `Изменена дата аукциона: ${formatDate(oldTender.startDate)} -> ${formatDate(newTender.startDate)}`;\n}\n\nfunction comparePublishedDates(oldTender, newTender) {\n    if (oldTender.datePublished === newTender.datePublished) {\n        return 0;\n    } else return `Изменена дата публикации: ${formatDate(oldTender.datePublished)} -> ${formatDate(newTender.datePublished)}`;\n}\n\nfunction compareIds(oldTender, newTender) {\n    if (oldTender.tenderID === newTender.tenderID) {\n        return 0;\n    } else return `Изменен идентификатор: ${oldTender.tenderID} -> ${newTender.tenderID}`\n}\n\nfunction compareTitles(oldTender, newTender) {\n    if (oldTender.title === newTender.title) {\n        return 0;\n    } else return `Изменено описание: ${oldTender.title} -> ${newTender.title}`\n}\n\nfunction compareAmounts(oldTender, newTender) {\n    if (Number.parseInt(oldTender.amount) === Number.parseInt(newTender.amount)) {\n        return 0;\n    } else return `Изменен бюджет: ${oldTender.amount} -> ${newTender.amount}`\n}\n\nfunction compareCurrencies(oldTender, newTender) {\n    if (oldTender.currency === newTender.currency) {\n        return 0;\n    } else return `Изменена валюта: ${oldTender.currency} -> ${newTender.currency}`\n}\n\nfunction compareStatuses(oldTender, newTender) {\n    if (oldTender.status === newTender.status) {\n        return 0;\n    } else return `Изменен статус: ${oldTender.status} -> ${newTender.status}`\n}\n\nfunction compareArrays(oldArray, newArray) {\n    let tOldArray = [];\n    let tNewArray = [];\n    if (oldArray) {\n        tOldArray = oldArray;\n    } else {\n        tOldArray = [];\n    }\n\n    if (newArray) {\n        tNewArray = newArray;\n    } else {\n        tNewArray = [];\n    }\n\n    let added = [];\n    let deleted = [];\n    tNewArray.forEach(el => {\n        if (tOldArray.indexOf(el) === -1) {\n            added.push(el);\n        }\n    });\n\n    tOldArray.forEach(el => {\n        if (tNewArray.indexOf(el) === -1) {\n            deleted.push(el);\n        }\n    });\n\n    if (added.length === 0 && deleted.length === 0) {\n        return 0;\n    } else {\n        if (added.length === 0 && deleted.length !== 0) {\n            return {deleted: deleted}\n        }\n        if (added.length !== 0 && deleted.length === 0) {\n            return {added: added}\n        }\n        if (added.length !== 0 && deleted.length !== 0) {\n            return {added: added, deleted: deleted}\n        }\n    }\n}\n\nfunction compareArraysDesc(oldTender, newTender, fName, description) {\n    const compareResult = compareArrays(oldTender[fName], newTender[fName]);\n    if (compareResult === 0) {\n        return 0;\n    } else {\n        let added = '';\n        let deleted = '';\n        if (compareResult.added) {\n            added = `Добавлены ${description}:  + ${compareResult.added.join(', ')}`;\n        }\n        if (compareResult.deleted) {\n            deleted = `Удалены ${description}:  + ${compareResult.deleted.join(', ')}`;\n        }\n\n        if (added.length > 0 && deleted.length > 0) {\n            return added + '; ' + deleted;\n        }\n\n        if (added.length > 0 && deleted.length === 0) {\n            return added;\n        }\n\n        if (added.length === 0 && deleted.length > 0) {\n            return deleted;\n        }\n\n    }\n}\n\nfunction compareTenderers(oldTender, newTender) {\n    return compareArraysDesc(oldTender, newTender, 'tenderers', 'участники');\n}\n\nfunction compareSuppliers(oldTender, newTender) {\n    return compareArraysDesc(oldTender, newTender, 'suppliers', 'победители');\n}\n\nfunction compareItems(oldTender, newTender) {\n    return compareArraysDesc(oldTender, newTender, 'items', 'товары');\n}\n\nfunction compareClassification_ids(oldTender, newTender) {\n    return compareArraysDesc(oldTender, newTender, 'classification_ids', 'классификаторы');\n}\n\nexport default function (oldTender, newTender) {\n\n    /*const newTender = {\n        \"_id\": \"a188a975c4984bd68c67e61ef187c54e\",\n        \"history\": {\n            \"2018-5-21\": \"Added to DB\"\n        },\n        \"status\": \"Закупка не состоялась\",\n        \"currency\": \"UAH\",\n        \"amount\": \"7500000\",\n        \"title\": \"“Послуги з технічної підтримки програмного забезпечення Oracle Database”.\",\n        \"tenderID\": \"UA-2017-10-13-001799-a\",\n        \"awardCriteria\": \"lowestCost\",\n        \"startDate\": \"2017-11-23T12:38:39+02:00\",\n        \"datePublished\": \"2017-10-13T14:06:56.116592+03:00\",\n        \"name\": \"Національний Банк України\",\n        \"classification_ids\": [\n            \"72260000-5\"\n        ],\n        \"items\": [\n            \"Послуги, пов’язані з програмним забезпеченням\"\n        ],\n        \"tenderers\": [\n            \"ТОВ \\\"ОС КОНСАЛТІНГ\\\"\",\n            \"ТОВ \\\"РДТЕХ\\\"\",\n            \"Приватне Акціонерне Товариство \\\"Пріоком\\\"\",\n            \"ТОВ \\\"ЦЕНТР СИСТЕМНОЇ ІНТЕГРАЦІЇ\\\"\",\n            \"ТОВ \\\"DILDO\\\"\"\n        ],\n        \"__v\": 0\n    };*/\n\n    let tenderDifferences = {};\n    if (compareNames(oldTender, newTender) !== 0) {\n        tenderDifferences.names = compareNames(oldTender, newTender);\n    }\n\n    if (compareStartDates(oldTender, newTender) !== 0) {\n        tenderDifferences.startDates = compareStartDates(oldTender, newTender).toString();\n    }\n\n    if (comparePublishedDates(oldTender, newTender) !== 0) {\n        tenderDifferences.PublishedDates = comparePublishedDates(oldTender, newTender)\n    }\n\n    if (compareIds(oldTender, newTender) !== 0) {\n        tenderDifferences.iDs = compareIds(oldTender, newTender)\n    }\n\n    if (compareTitles(oldTender, newTender) !== 0) {\n        tenderDifferences.titles = compareTitles(oldTender, newTender);\n    }\n\n    if (compareAmounts(oldTender, newTender) !== 0) {\n        tenderDifferences.amounts = compareAmounts(oldTender, newTender);\n    }\n\n    if (compareCurrencies(oldTender, newTender) !== 0) {\n        tenderDifferences.currencies = compareCurrencies(oldTender, newTender);\n    }\n\n    if (compareStatuses(oldTender, newTender) !== 0) {\n        tenderDifferences.statuses = compareStatuses(oldTender, newTender)\n    }\n\n\n    if (compareTenderers(oldTender, newTender) !== 0) {\n        tenderDifferences = Object.assign({}, tenderDifferences, {tenderers: compareTenderers(oldTender, newTender)})\n    }\n\n    if (compareSuppliers(oldTender, newTender) !== 0) {\n        tenderDifferences.suppliers = compareSuppliers(oldTender, newTender)\n    }\n\n    if (compareItems(oldTender, newTender) !== 0) {\n        tenderDifferences.items = compareItems(oldTender, newTender)\n    }\n\n    if (compareClassification_ids(oldTender, newTender) !== 0) {\n        tenderDifferences.classification_ids = compareClassification_ids(oldTender, newTender)\n    }\n\n    return tenderDifferences;\n}\n"]}