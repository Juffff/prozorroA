{"version":3,"sources":["../../../build/server/app.js"],"names":["_path","require","_path2","_interopRequireDefault","console","log","default","__dirname","_express","_express2","_bodyParser","_bodyParser2","_cors","_cors2","_got","_got2","_nodeCron","_nodeCron2","_dbutils","db","_interopRequireWildcard","_item_id","_item_id2","_tender_status","_tender_status2","_logger","_logger2","_errorHandler","_errorHandler2","_config","_config2","_expressStatic","_expressStatic2","obj","__esModule","newObj","key","Object","prototype","hasOwnProperty","call","connect","corsOptions","origin","optionsSuccessStatus","pause","seconds","waitTill","Date","getTime","app","use","json","startUri","apiPrefix","prefix","process","on","err","stack","error","getNextURI","uri","goThrowTenders","get","req","res","send","setTimeout","listTenders","data","sendStatus","join","task1Hour","stop","task5Min","milliseconds","https","str","chunk","resJson","JSON","parse","nextUri","next_page","length","setNextURI","start","map","id","forEach","analiseToTender","updateExistedTenders","tender","getTenderByID","_id","then","body","allInfo","questions","complaints","value","amount","Number","parseInt","minAmount","maxAmount","name","procuringEntity","auctionPeriod","startDate","undefined","documents","Array","isArray","datePublished","enquiryPeriod","invalidationDate","awardCriteria","bids","tenderers","filter","bid","tenderer","replace","items","itemIDs","classificationIDs","item","indexOf","classification","description","push","classification_ids","tenderID","title","currency","status","suppliers","awards","award","supplier","a","createTender","listen","env","PORT","schedule","listAllTenders"],"mappings":"AAAA;;AACA,IAAIA,QAAQC,QAAQ,MAAR,CAAZ;AACA,IAAIC,SAASC,uBAAuBH,KAAvB,CAAb;;AAGAI,QAAQC,GAAR,CAAY,CAAC,GAAGH,OAAOI,OAAX,EAAoBC,SAApB,CAAZ;AACAH,QAAQC,GAAR,CAAY,CAAC,GAAGH,OAAOI,OAAX,EAAoBC,SAApB,EAA+B,QAA/B,CAAZ;;AAKA,IAAIC,WAAWP,QAAQ,SAAR,CAAf;;AAEA,IAAIQ,YAAYN,uBAAuBK,QAAvB,CAAhB;;AAEA,IAAIE,cAAcT,QAAQ,aAAR,CAAlB;;AAEA,IAAIU,eAAeR,uBAAuBO,WAAvB,CAAnB;;AAEA,IAAIE,QAAQX,QAAQ,MAAR,CAAZ;;AAEA,IAAIY,SAASV,uBAAuBS,KAAvB,CAAb;;AAEA,IAAIE,OAAOb,QAAQ,KAAR,CAAX;;AAEA,IAAIc,QAAQZ,uBAAuBW,IAAvB,CAAZ;;AAEA,IAAIE,YAAYf,QAAQ,WAAR,CAAhB;;AAEA,IAAIgB,aAAad,uBAAuBa,SAAvB,CAAjB;;AAEA,IAAIE,WAAWjB,QAAQ,8BAAR,CAAf;;AAEA,IAAIkB,KAAKC,wBAAwBF,QAAxB,CAAT;;AAEA,IAAIG,WAAWpB,QAAQ,8BAAR,CAAf;;AAEA,IAAIqB,YAAYnB,uBAAuBkB,QAAvB,CAAhB;;AAEA,IAAIE,iBAAiBtB,QAAQ,oCAAR,CAArB;;AAEA,IAAIuB,kBAAkBrB,uBAAuBoB,cAAvB,CAAtB;;AAEA,IAAIE,UAAUxB,QAAQ,6BAAR,CAAd;;AAEA,IAAIyB,WAAWvB,uBAAuBsB,OAAvB,CAAf;;AAEA,IAAIE,gBAAgB1B,QAAQ,6BAAR,CAApB;;AAEA,IAAI2B,iBAAiBzB,uBAAuBwB,aAAvB,CAArB;;AAEA,IAAIE,UAAU5B,QAAQ,8BAAR,CAAd;;AAEA,IAAI6B,WAAW3B,uBAAuB0B,OAAvB,CAAf;;AAEA,IAAIE,iBAAiB9B,QAAQ,gBAAR,CAArB;;AAEA,IAAI+B,kBAAkB7B,uBAAuB4B,cAAvB,CAAtB;;AAEA,SAASX,uBAAT,CAAiCa,GAAjC,EAAsC;AAAE,QAAIA,OAAOA,IAAIC,UAAf,EAA2B;AAAE,eAAOD,GAAP;AAAa,KAA1C,MAAgD;AAAE,YAAIE,SAAS,EAAb,CAAiB,IAAIF,OAAO,IAAX,EAAiB;AAAE,iBAAK,IAAIG,GAAT,IAAgBH,GAAhB,EAAqB;AAAE,oBAAII,OAAOC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCP,GAArC,EAA0CG,GAA1C,CAAJ,EAAoDD,OAAOC,GAAP,IAAcH,IAAIG,GAAJ,CAAd;AAAyB;AAAE,SAACD,OAAO7B,OAAP,GAAiB2B,GAAjB,CAAsB,OAAOE,MAAP;AAAgB;AAAE;;AAE7Q,SAAShC,sBAAT,CAAgC8B,GAAhC,EAAqC;AAAE,WAAOA,OAAOA,IAAIC,UAAX,GAAwBD,GAAxB,GAA8B,EAAE3B,SAAS2B,GAAX,EAArC;AAAwD;;AAE/F;;AAGAd,GAAGsB,OAAH;AACA,IAAIC,cAAc;AACdC,YAAQ,GADM;AAEdC,0BAAsB,GAFR,CAEY;AAFZ,CAAlB;;AAKA,SAASC,KAAT,CAAeC,OAAf,EAAwB;AACpB,QAAIC,WAAW,IAAIC,IAAJ,CAAS,IAAIA,IAAJ,GAAWC,OAAX,KAAuBH,UAAU,IAA1C,CAAf;AACA,WAAOC,WAAW,IAAIC,IAAJ,EAAlB,EAA8B,CAAE;AACnC;;AAED,IAAIE,MAAM,CAAC,GAAGzC,UAAUH,OAAd,GAAV;AACA4C,IAAIC,GAAJ,CAAQxC,aAAaL,OAAb,CAAqB8C,IAArB,EAAR;AACAF,IAAIC,GAAJ,CAAQ,CAAC,GAAGtC,OAAOP,OAAX,EAAoBoC,WAApB,CAAR;;AAEA,IAAIW,WAAWvB,SAASxB,OAAT,CAAiB+C,QAAhC;AACA,IAAIC,YAAYxB,SAASxB,OAAT,CAAiBiD,MAAjC;;AAEAC,QAAQC,EAAR,CAAW,mBAAX,EAAgC,UAAUC,GAAV,EAAe;AAC3ChC,aAASpB,OAAT,CAAiBD,GAAjB,CAAqB,OAArB,EAA8BqD,IAAIC,KAAlC;AACAvD,YAAQwD,KAAR,CAAcF,IAAIC,KAAlB;AACAvD,YAAQC,GAAR,CAAY,qBAAZ;AACAc,OAAG0C,UAAH,CAAc,UAAUC,GAAV,EAAe;AACzB,YAAIA,GAAJ,EAAS;AACLC,2BAAeD,GAAf;AACH,SAFD,MAEO;AACHC,2BAAeV,QAAf;AACH;AACJ,KAND;AAOH,CAXD;;AAaAH,IAAIc,GAAJ,CAAQ,QAAR,EAAkB,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAClC/C,OAAG0C,UAAH,CAAc,UAAUC,GAAV,EAAe;AACzB,YAAIA,GAAJ,EAAS;AACLC,2BAAeD,GAAf;AACH,SAFD,MAEO;AACHC,2BAAeV,QAAf;AACH;AACDa,YAAIC,IAAJ,CAAS,GAAT;AACH,KAPD;AAQAC,eAAW,YAAY;AACnBhE,gBAAQC,GAAR,CAAY,gBAAZ;AACAc,WAAG0C,UAAH,CAAc,UAAUC,GAAV,EAAe;AACzB,gBAAIA,GAAJ,EAAS;AACLC,+BAAeD,GAAf;AACH,aAFD,MAEO;AACHC,+BAAeV,QAAf;AACH;AACJ,SAND;AAOH,KATD,EASG,KATH;AAUH,CAnBD,EAmBGW,GAnBH,CAmBO,YAnBP,EAmBqB,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACrCH,mBAAe,oEAAf;AACAG,QAAIC,IAAJ,CAAS,GAAT;AACH,CAtBD,EAsBGH,GAtBH,CAsBO,UAtBP,EAsBmB,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACnC/C,OAAGkD,WAAH,CAAe,EAAf,EAAmB,UAAUC,IAAV,EAAgB;AAC/BJ,YAAIC,IAAJ,CAASG,IAAT;AACH,KAFD;AAGH,CA1BD,EA0BGN,GA1BH,CA0BO,OA1BP,EA0BgB,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAChCA,QAAIK,UAAJ,CAAe,GAAf;AACH,CA5BD;;AA8BArB,IAAIC,GAAJ,CAAQ,GAAR,EAAa,CAAC,GAAGnB,gBAAgB1B,OAApB,EAA6BJ,OAAOI,OAAP,CAAekE,IAAf,CAAoBjE,SAApB,EAA+B,IAA/B,EAAqC,QAArC,CAA7B,CAAb;;AAEA,SAASwD,cAAT,CAAwBD,GAAxB,EAA6B;AACzBW,cAAUC,IAAV;AACAC,aAASD,IAAT;AACAtE,YAAQC,GAAR,CAAY,QAAZ,EAAsByD,GAAtB;AACA,QAAIc,eAAe,IAAnB;;AAEA,QAAIC,QAAQ5E,QAAQ,OAAR,CAAZ;AACA4E,UAAMb,GAAN,CAAUF,GAAV,EAAe,UAAUI,GAAV,EAAe;AAC1BU,uBAAe,IAAI5B,IAAJ,GAAWC,OAAX,EAAf;AACA,YAAI6B,MAAM,EAAV;AACAZ,YAAIT,EAAJ,CAAO,MAAP,EAAe,UAAUsB,KAAV,EAAiB;AAC5BD,mBAAOC,KAAP;AACH,SAFD;AAGAb,YAAIT,EAAJ,CAAO,KAAP,EAAc,YAAY;AACtB,gBAAIuB,UAAUC,KAAKC,KAAL,CAAWJ,GAAX,CAAd;AACA,gBAAIK,UAAUH,QAAQI,SAAR,CAAkBtB,GAAhC;AACA,gBAAIQ,OAAOU,QAAQV,IAAnB;AACA;AACA,gBAAIA,KAAKe,MAAL,KAAgB,CAApB,EAAuB;AACnB3D,yBAASpB,OAAT,CAAiBD,GAAjB,CAAqB,MAArB,EAA6B,yBAA7B;AACAD,wBAAQC,GAAR,CAAY,4BAAZ;AACAc,mBAAGmE,UAAH,CAAcjC,QAAd;AACAoB,0BAAUc,KAAV;AACAZ,yBAASY,KAAT;AACH,aAND,MAMO;AACHP,wBAAQV,IAAR,CAAakB,GAAb,CAAiB,UAAUlB,IAAV,EAAgB;AAC7B,2BAAOA,KAAKmB,EAAZ;AACH,iBAFD,EAEGC,OAFH,CAEW,UAAUD,EAAV,EAAc;AACrBE,oCAAgBrC,SAAhB,EAA2BmC,EAA3B,EAA+B3B,GAA/B;AACH,iBAJD;AAKA3C,mBAAGmE,UAAH,CAAcH,OAAd;AACApB,+BAAeoB,OAAf;AACH;AACJ,SApBD;AAqBH,KA3BD;AA4BH;;AAED,SAASS,oBAAT,CAA8BtB,IAA9B,EAAoC;AAChCA,SAAKoB,OAAL,CAAa,UAAUG,MAAV,EAAkB;AAC3B1E,WAAG2E,aAAH,CAAiBD,MAAjB,EAAyB,UAAUA,MAAV,EAAkB;AACvCF,4BAAgBrC,SAAhB,EAA2BuC,OAAOE,GAAlC;AACH,SAFD;AAGH,KAJD;AAKH;;AAED,SAASJ,eAAT,CAAyBpC,MAAzB,EAAiCkC,EAAjC,EAAqC3B,GAArC,EAA0C;AACtC,QAAI;AACA,SAAC,GAAG/C,MAAMT,OAAV,EAAmB,KAAKiD,MAAL,GAAckC,EAAjC,EAAqCO,IAArC,CAA0C,UAAU1B,IAAV,EAAgB;AACtD,gBAAIA,KAAK2B,IAAT,EAAe;AACX,oBAAI;AACA,wBAAIC,UAAUjB,KAAKC,KAAL,CAAWZ,KAAK2B,IAAhB,EAAsB3B,IAApC;AACA,wBAAI4B,OAAJ,EAAa;AACT,+BAAOA,QAAQC,SAAf;AACA,+BAAOD,QAAQE,UAAf;AACA,4BAAIP,SAAS,EAAb;AACA,4BAAI;AACA,gCAAIK,QAAQG,KAAZ,EAAmB;AACfR,uCAAOS,MAAP,GAAgBJ,QAAQG,KAAR,CAAcC,MAA9B;AACA,oCAAIC,OAAOC,QAAP,CAAgBX,OAAOS,MAAvB,EAA+B,EAA/B,IAAqCxE,SAASxB,OAAT,CAAiBmG,SAAtD,IAAmEF,OAAOC,QAAP,CAAgBX,OAAOS,MAAvB,EAA+B,EAA/B,IAAqCxE,SAASxB,OAAT,CAAiBoG,SAA7H,EAAwI;AACpIb,2CAAOE,GAAP,GAAaG,QAAQT,EAArB;AACAI,2CAAOc,IAAP,GAAcT,QAAQU,eAAR,CAAwBD,IAAtC;AACA,wCAAIT,QAAQW,aAAZ,EAA2B;AACvBhB,+CAAOiB,SAAP,GAAmBZ,QAAQW,aAAR,CAAsBC,SAAzC;AACA,4CAAIjB,OAAOiB,SAAP,KAAqBC,SAAzB,EAAoC;AAChC,gDAAIb,QAAQc,SAAZ,EAAuB;AACnB,oDAAIC,MAAMC,OAAN,CAAchB,QAAQc,SAAtB,CAAJ,EAAsC;AAClC,wDAAId,QAAQc,SAAR,CAAkB,CAAlB,CAAJ,EAA0B;AACtBnB,+DAAOiB,SAAP,GAAmBZ,QAAQc,SAAR,CAAkB,CAAlB,EAAqBG,aAAxC;AACH;AACJ;AACJ;AACJ;AACJ;AACD,wCAAIjB,QAAQkB,aAAZ,EAA2B;AACvBvB,+CAAOsB,aAAP,GAAuBjB,QAAQkB,aAAR,CAAsBC,gBAA7C;AACH;AACDxB,2CAAOyB,aAAP,GAAuBpB,QAAQoB,aAA/B;AACA,wCAAIpB,QAAQqB,IAAZ,EAAkB;AACd1B,+CAAO2B,SAAP,GAAmBtB,QAAQqB,IAAR,CAAaE,MAAb,CAAoB,UAAUC,GAAV,EAAe;AAClD,gDAAIA,IAAIF,SAAR,EAAmB;AACf,oDAAIG,WAAWD,IAAIF,SAAJ,CAAc,CAAd,EAAiBb,IAAhC;AACA,uDAAOgB,aAAa,IAApB;AACH;AACD,mDAAO,KAAP;AACH,yCANkB,EAMhBnC,GANgB,CAMZ,UAAUmC,QAAV,EAAoB;AACvB,mDAAOA,SAASH,SAAT,CAAmB,CAAnB,EAAsBb,IAAtB,CAA2BiB,OAA3B,CAAmC,yCAAnC,EAA8E,KAA9E,EAAqFA,OAArF,CAA6F,GAA7F,EAAkG,IAAlG,EAAwGA,OAAxG,CAAgH,GAAhH,EAAqH,IAArH,CAAP;AACH,yCARkB,CAAnB;AASH;;AAED,wCAAI1B,QAAQ2B,KAAZ,EAAmB;AACf,4CAAIC,UAAU,EAAd;AACA,4CAAIC,oBAAoB,EAAxB;;AAEA7B,gDAAQ2B,KAAR,CAAcnC,OAAd,CAAsB,UAAUsC,IAAV,EAAgB;AAClC,gDAAIF,QAAQG,OAAR,CAAgBD,KAAKE,cAAL,CAAoBC,WAApC,MAAqD,CAAC,CAA1D,EAA6D;AACzDL,wDAAQM,IAAR,CAAaJ,KAAKE,cAAL,CAAoBC,WAAjC;AACH;AACJ,yCAJD;AAKAjC,gDAAQ2B,KAAR,CAAcnC,OAAd,CAAsB,UAAUsC,IAAV,EAAgB;AAClC,gDAAID,kBAAkBE,OAAlB,CAA0BD,KAAKE,cAAL,CAAoBzC,EAA9C,MAAsD,CAAC,CAA3D,EAA8D;AAC1DsC,kEAAkBK,IAAlB,CAAuBJ,KAAKE,cAAL,CAAoBzC,EAA3C;AACH;AACJ,yCAJD;AAKAI,+CAAOgC,KAAP,GAAeC,OAAf;AACAjC,+CAAOwC,kBAAP,GAA4BN,iBAA5B;AACH;AACDlC,2CAAOyC,QAAP,GAAkBpC,QAAQoC,QAA1B;AACAzC,2CAAO0C,KAAP,GAAerC,QAAQqC,KAAvB;AACA1C,2CAAO2C,QAAP,GAAkBtC,QAAQG,KAAR,CAAcmC,QAAhC;AACA3C,2CAAO4C,MAAP,GAAgBjH,gBAAgBlB,OAAhB,CAAwB4F,QAAQuC,MAAhC,CAAhB;AACA,wCAAI5C,OAAO4C,MAAP,KAAkBjH,gBAAgBlB,OAAhB,CAAwB,UAAxB,CAAlB,IAAyDuF,OAAO4C,MAAP,KAAkBjH,gBAAgBlB,OAAhB,CAAwB,gBAAxB,CAA/E,EAA0H;AACtH,4CAAIoI,YAAY,EAAhB;AACA,4CAAIxC,QAAQyC,MAAZ,EAAoB;AAChB,gDAAI1B,MAAMC,OAAN,CAAchB,QAAQyC,MAAtB,CAAJ,EAAmC;AAC/BzC,wDAAQyC,MAAR,CAAejD,OAAf,CAAuB,UAAUkD,KAAV,EAAiB;AACpC,wDAAIA,MAAMF,SAAV,EAAqB;AACjB,4DAAIzB,MAAMC,OAAN,CAAc0B,MAAMF,SAApB,CAAJ,EAAoC;AAChCE,kEAAMF,SAAN,CAAgBhD,OAAhB,CAAwB,UAAUmD,QAAV,EAAoB;AACxC,oEAAIH,UAAUT,OAAV,CAAkBY,SAASlC,IAA3B,MAAqC,CAAC,CAA1C,EAA6C;AACzC+B,8EAAUN,IAAV,CAAeS,SAASlC,IAAxB;AACH;AACJ,6DAJD;AAKH;AACJ;AACJ,iDAVD;AAWH;AACJ;AACDd,+CAAO6C,SAAP,GAAmBA,SAAnB;AACH;AACD,wCAAI,CAAC7C,OAAO2B,SAAR,IAAqB3B,OAAO6C,SAAhC,EAA2C;AACvC7C,+CAAO2B,SAAP,GAAmB3B,OAAO6C,SAA1B;AACH;AACD,wCAAII,IAAI,KAAR;AACA,wCAAIjD,OAAOwC,kBAAX,EAA+B;AAC3B,4CAAIpB,MAAMC,OAAN,CAAcrB,OAAOwC,kBAArB,CAAJ,EAA8C;AAC1CxC,mDAAOwC,kBAAP,CAA0B3C,OAA1B,CAAkC,UAAUD,EAAV,EAAc;AAC5C,oDAAInE,UAAUhB,OAAV,CAAkB2H,OAAlB,CAA0BxC,EAA1B,IAAgC,CAAC,CAArC,EAAwC;AACpCqD,wDAAI,IAAJ;AACH;AACJ,6CAJD;AAKH;AACJ;AACD,wCAAIA,MAAM,IAAV,EAAgB;AACZ;AACA;;AAEA3H,2CAAG4H,YAAH,CAAgBlD,MAAhB;AACAiD,4CAAI,KAAJ;AACH;AACJ;AACJ;AACD;AACH,yBAjGD,CAiGE,OAAOpF,GAAP,EAAY;AACVtD,oCAAQC,GAAR,CAAY6F,QAAQT,EAApB;AACArF,oCAAQC,GAAR,CAAY6F,QAAQoC,QAApB;AACAlI,oCAAQC,GAAR,CAAYmB,gBAAgBlB,OAAhB,CAAwB4F,QAAQuC,MAAhC,CAAZ;AACArI,oCAAQC,GAAR,CAAYwF,OAAOS,MAAnB;AACAlG,oCAAQC,GAAR,CAAYqD,GAAZ;AACA;AACH;AACJ;AACJ,iBAhHD,CAgHE,OAAOA,GAAP,EAAY;AACV,qBAAC,GAAG9B,eAAetB,OAAnB,EAA4BoD,GAA5B;AACH;AACJ;AACJ,SAtHD;AAuHH,KAxHD,CAwHE,OAAOA,GAAP,EAAY;AACVtD,gBAAQC,GAAR,CAAYqD,GAAZ;AACH;AACJ;;AAED;;;;AAIAR,IAAI8F,MAAJ,CAAWxF,QAAQyF,GAAR,CAAYC,IAAZ,IAAoB,IAA/B,EAAqC,YAAY;AAC7C,QAAI1F,QAAQyF,GAAR,CAAYC,IAAhB,EAAsB;AAClB9I,gBAAQC,GAAR,CAAY,0BAA0BmD,QAAQyF,GAAR,CAAYC,IAAlD;AACH,KAFD,MAEO;AACH9I,gBAAQC,GAAR,CAAY,2BAAZ;AACH;AACJ,CAND;;AAQA;;;;AAIA;;;;AAIA,IAAIsE,WAAW1D,WAAWX,OAAX,CAAmB6I,QAAnB,CAA4B,aAA5B,EAA2C,YAAY;AAClEzH,aAASpB,OAAT,CAAiBD,GAAjB,CAAqB,MAArB,EAA6B,kBAA7B;AACAc,OAAGiI,cAAH,CAAkB,UAAU9E,IAAV,EAAgB;AAC9BsB,6BAAqBtB,IAArB;AACH,KAFD;AAGH,CALc,EAKZ,KALY,CAAf;;AAOA,IAAIG,YAAYxD,WAAWX,OAAX,CAAmB6I,QAAnB,CAA4B,aAA5B,EAA2C,YAAY;AACnEzH,aAASpB,OAAT,CAAiBD,GAAjB,CAAqB,MAArB,EAA6B,mBAA7B;AACAc,OAAG0C,UAAH,CAAc,UAAUC,GAAV,EAAe;AACzB,YAAIA,GAAJ,EAAS;AACLC,2BAAeD,GAAf;AACH,SAFD,MAEO;AACHC,2BAAeV,QAAf;AACH;AACJ,KAND;AAOAe,eAAW,YAAY;AACnBhE,gBAAQC,GAAR,CAAY,gBAAZ;AACAc,WAAG0C,UAAH,CAAc,UAAUC,GAAV,EAAe;AACzB,gBAAIA,GAAJ,EAAS;AACLC,+BAAeD,GAAf;AACH,aAFD,MAEO;AACHC,+BAAeV,QAAf;AACH;AACJ,SAND;AAOH,KATD,EASG,KATH;AAUH,CAnBe,EAmBb,KAnBa,CAAhB;;AAqBAsB,SAASY,KAAT;AACAd,UAAUc,KAAV","file":"app.js","sourcesContent":["'use strict';\nvar _path = require('path');\nvar _path2 = _interopRequireDefault(_path);\n\n\nconsole.log((0, _path2.default)(__dirname));\nconsole.log((0, _path2.default)(__dirname, 'server'));\n\n\n\n\nvar _express = require('express');\n\nvar _express2 = _interopRequireDefault(_express);\n\nvar _bodyParser = require('body-parser');\n\nvar _bodyParser2 = _interopRequireDefault(_bodyParser);\n\nvar _cors = require('cors');\n\nvar _cors2 = _interopRequireDefault(_cors);\n\nvar _got = require('got');\n\nvar _got2 = _interopRequireDefault(_got);\n\nvar _nodeCron = require('node-cron');\n\nvar _nodeCron2 = _interopRequireDefault(_nodeCron);\n\nvar _dbutils = require('./build/server/utils/dbutils');\n\nvar db = _interopRequireWildcard(_dbutils);\n\nvar _item_id = require('./build/server/enums/item_id');\n\nvar _item_id2 = _interopRequireDefault(_item_id);\n\nvar _tender_status = require('./build/server/enums/tender_status');\n\nvar _tender_status2 = _interopRequireDefault(_tender_status);\n\nvar _logger = require('./build/server/utils/logger');\n\nvar _logger2 = _interopRequireDefault(_logger);\n\nvar _errorHandler = require('./build/server/errorHandler');\n\nvar _errorHandler2 = _interopRequireDefault(_errorHandler);\n\nvar _config = require('./build/server/config/config');\n\nvar _config2 = _interopRequireDefault(_config);\n\nvar _expressStatic = require('express-static');\n\nvar _expressStatic2 = _interopRequireDefault(_expressStatic);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/*console.log(JSON.parse(document.getElementsByTagName('pre')[0].innerHTML))*/\n\n\ndb.connect();\nvar corsOptions = {\n    origin: '*',\n    optionsSuccessStatus: 200 // some legacy browsers (IE11, various SmartTVs) choke on 204\n};\n\nfunction pause(seconds) {\n    var waitTill = new Date(new Date().getTime() + seconds * 1000);\n    while (waitTill > new Date()) {}\n}\n\nvar app = (0, _express2.default)();\napp.use(_bodyParser2.default.json());\napp.use((0, _cors2.default)(corsOptions));\n\nvar startUri = _config2.default.startUri;\nvar apiPrefix = _config2.default.prefix;\n\nprocess.on('uncaughtException', function (err) {\n    _logger2.default.log('error', err.stack);\n    console.error(err.stack);\n    console.log(\"Node NOT Exiting...\");\n    db.getNextURI(function (uri) {\n        if (uri) {\n            goThrowTenders(uri);\n        } else {\n            goThrowTenders(startUri);\n        }\n    });\n});\n\napp.get('/start', function (req, res) {\n    db.getNextURI(function (uri) {\n        if (uri) {\n            goThrowTenders(uri);\n        } else {\n            goThrowTenders(startUri);\n        }\n        res.send(200);\n    });\n    setTimeout(function () {\n        console.log('Wake and move!');\n        db.getNextURI(function (uri) {\n            if (uri) {\n                goThrowTenders(uri);\n            } else {\n                goThrowTenders(startUri);\n            }\n        });\n    }, 60000);\n}).get('/start2018', function (req, res) {\n    goThrowTenders('https://public.api.openprocurement.org/api/2.4/tenders?offset=2018');\n    res.send(200);\n}).get('/tenders', function (req, res) {\n    db.listTenders({}, function (data) {\n        res.send(data);\n    });\n}).get('/ping', function (req, res) {\n    res.sendStatus(200);\n});\n\napp.use('/', (0, _expressStatic2.default)(_path2.default.join(__dirname, '..', 'client')));\n\nfunction goThrowTenders(uri) {\n    task1Hour.stop();\n    task5Min.stop();\n    console.log('uri - ', uri);\n    var milliseconds = null;\n\n    var https = require('https');\n    https.get(uri, function (res) {\n        milliseconds = new Date().getTime();\n        var str = '';\n        res.on('data', function (chunk) {\n            str += chunk;\n        });\n        res.on('end', function () {\n            var resJson = JSON.parse(str);\n            var nextUri = resJson.next_page.uri;\n            var data = resJson.data;\n            //  console.log(data.length);\n            if (data.length === 0) {\n                _logger2.default.log('info', 'goThrowTenders finished');\n                console.log('Go throw tenders finished.');\n                db.setNextURI(startUri);\n                task1Hour.start();\n                task5Min.start();\n            } else {\n                resJson.data.map(function (data) {\n                    return data.id;\n                }).forEach(function (id) {\n                    analiseToTender(apiPrefix, id, uri);\n                });\n                db.setNextURI(nextUri);\n                goThrowTenders(nextUri);\n            }\n        });\n    });\n}\n\nfunction updateExistedTenders(data) {\n    data.forEach(function (tender) {\n        db.getTenderByID(tender, function (tender) {\n            analiseToTender(apiPrefix, tender._id);\n        });\n    });\n}\n\nfunction analiseToTender(prefix, id, uri) {\n    try {\n        (0, _got2.default)('' + prefix + id).then(function (data) {\n            if (data.body) {\n                try {\n                    var allInfo = JSON.parse(data.body).data;\n                    if (allInfo) {\n                        delete allInfo.questions;\n                        delete allInfo.complaints;\n                        var tender = {};\n                        try {\n                            if (allInfo.value) {\n                                tender.amount = allInfo.value.amount;\n                                if (Number.parseInt(tender.amount, 10) > _config2.default.minAmount && Number.parseInt(tender.amount, 10) < _config2.default.maxAmount) {\n                                    tender._id = allInfo.id;\n                                    tender.name = allInfo.procuringEntity.name;\n                                    if (allInfo.auctionPeriod) {\n                                        tender.startDate = allInfo.auctionPeriod.startDate;\n                                        if (tender.startDate === undefined) {\n                                            if (allInfo.documents) {\n                                                if (Array.isArray(allInfo.documents)) {\n                                                    if (allInfo.documents[0]) {\n                                                        tender.startDate = allInfo.documents[0].datePublished;\n                                                    }\n                                                }\n                                            }\n                                        }\n                                    }\n                                    if (allInfo.enquiryPeriod) {\n                                        tender.datePublished = allInfo.enquiryPeriod.invalidationDate;\n                                    }\n                                    tender.awardCriteria = allInfo.awardCriteria;\n                                    if (allInfo.bids) {\n                                        tender.tenderers = allInfo.bids.filter(function (bid) {\n                                            if (bid.tenderers) {\n                                                var tenderer = bid.tenderers[0].name;\n                                                return tenderer !== null;\n                                            }\n                                            return false;\n                                        }).map(function (tenderer) {\n                                            return tenderer.tenderers[0].name.replace('ТОВАРИСТВО З ОБМЕЖЕНОЮ ВІДПОВІДАЛЬНІСТЮ', 'ТОВ').replace('«', '\\\"').replace('»', '\\\"');\n                                        });\n                                    }\n\n                                    if (allInfo.items) {\n                                        var itemIDs = [];\n                                        var classificationIDs = [];\n\n                                        allInfo.items.forEach(function (item) {\n                                            if (itemIDs.indexOf(item.classification.description) === -1) {\n                                                itemIDs.push(item.classification.description);\n                                            }\n                                        });\n                                        allInfo.items.forEach(function (item) {\n                                            if (classificationIDs.indexOf(item.classification.id) === -1) {\n                                                classificationIDs.push(item.classification.id);\n                                            }\n                                        });\n                                        tender.items = itemIDs;\n                                        tender.classification_ids = classificationIDs;\n                                    }\n                                    tender.tenderID = allInfo.tenderID;\n                                    tender.title = allInfo.title;\n                                    tender.currency = allInfo.value.currency;\n                                    tender.status = _tender_status2.default[allInfo.status];\n                                    if (tender.status === _tender_status2.default['complete'] || tender.status === _tender_status2.default['active.awarded']) {\n                                        var suppliers = [];\n                                        if (allInfo.awards) {\n                                            if (Array.isArray(allInfo.awards)) {\n                                                allInfo.awards.forEach(function (award) {\n                                                    if (award.suppliers) {\n                                                        if (Array.isArray(award.suppliers)) {\n                                                            award.suppliers.forEach(function (supplier) {\n                                                                if (suppliers.indexOf(supplier.name) === -1) {\n                                                                    suppliers.push(supplier.name);\n                                                                }\n                                                            });\n                                                        }\n                                                    }\n                                                });\n                                            }\n                                        }\n                                        tender.suppliers = suppliers;\n                                    }\n                                    if (!tender.tenderers && tender.suppliers) {\n                                        tender.tenderers = tender.suppliers;\n                                    }\n                                    var a = false;\n                                    if (tender.classification_ids) {\n                                        if (Array.isArray(tender.classification_ids)) {\n                                            tender.classification_ids.forEach(function (id) {\n                                                if (_item_id2.default.indexOf(id) > -1) {\n                                                    a = true;\n                                                }\n                                            });\n                                        }\n                                    }\n                                    if (a === true) {\n                                        //logger.log('info', `a tender was found - ${JSON.stringify(tender)}`);\n                                        /*   console.log(uri);\n                                        /!*       console.log(tender);*!/*/\n                                        db.createTender(tender);\n                                        a = false;\n                                    }\n                                }\n                            }\n                            //pause(0.05);\n                        } catch (err) {\n                            console.log(allInfo.id);\n                            console.log(allInfo.tenderID);\n                            console.log(_tender_status2.default[allInfo.status]);\n                            console.log(tender.amount);\n                            console.log(err);\n                            //pause(0.05);\n                        }\n                    }\n                } catch (err) {\n                    (0, _errorHandler2.default)(err);\n                }\n            }\n        });\n    } catch (err) {\n        console.log(err);\n    }\n}\n\n/*app.listen(8080, () => {\n    console.log(`Server is running on 8080`);\n});*/\n\napp.listen(process.env.PORT || 8080, function () {\n    if (process.env.PORT) {\n        console.log('Server is running on ' + process.env.PORT);\n    } else {\n        console.log('Server is running on 8080');\n    }\n});\n\n/*cron.schedule('1-59 * * * * * ', function(){\n    console.log('sec 2');\n}, true);*/\n\n/*const task1Min =  cron.schedule('*!/1 * * * *', function(){\n    console.log('minute 1');\n}, false);*/\n\nvar task5Min = _nodeCron2.default.schedule('*/5 * * * *', function () {\n    _logger2.default.log('info', '5MinTask started');\n    db.listAllTenders(function (data) {\n        updateExistedTenders(data);\n    });\n}, false);\n\nvar task1Hour = _nodeCron2.default.schedule('* */1 * * *', function () {\n    _logger2.default.log('info', '1HourTask started');\n    db.getNextURI(function (uri) {\n        if (uri) {\n            goThrowTenders(uri);\n        } else {\n            goThrowTenders(startUri);\n        }\n    });\n    setTimeout(function () {\n        console.log('Wake and move!');\n        db.getNextURI(function (uri) {\n            if (uri) {\n                goThrowTenders(uri);\n            } else {\n                goThrowTenders(startUri);\n            }\n        });\n    }, 60000);\n}, false);\n\ntask5Min.start();\ntask1Hour.start();"]}